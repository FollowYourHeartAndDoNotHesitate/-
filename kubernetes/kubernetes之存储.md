# 存储

[TOC]
- [存储](#存储)
  - [一、卷](#一卷)
    - [为什么需要卷（Volume）？](#为什么需要卷volume)
    - [卷的核心是什么？](#卷的核心是什么)
    - [Docker与Kubernetes中的卷存在什么异同?](#docker与kubernetes中的卷存在什么异同)
  - [二、持久卷](#二持久卷)


## 一、卷

### 为什么需要卷（Volume）？

Container中的文件，临时存放在磁盘上。由此给运行的应用程序带来如下问题：

- 容器崩溃时文件丢失，kubelet 会重新将容器以初始化的状态重新启动；

- 同一Pod 中运行多个容器，存在共享文件行为。

### 卷的核心是什么？

卷**核心**是一个目录，可存放数据，Pod中的容器可以访问卷中的数据。卷类型决定目录的如何形成、使用何种介质保存数以及目录中存放的内容。

### Docker与Kubernetes中的卷存在什么异同?

**Docker卷**

- 磁盘或其他容器内的一个目录；

- Docker提供卷驱动程序，功能非常有限。

**Kubernetes卷**

- 支持多种类型的卷；
- 临时卷类型生命周期与Pod相同；
- 持久卷比Pod的生命周期更长；
- 容器重启时，指定Pod任何类型的卷数据都会保存。

## 二、持久卷

持久卷（Persistent Volume，PV）是集群中的一块存储，使用卷插件实现，拥有独立于任何使用PV卷Pod的生命周期；既可管理员事先供应，也可以通过存储类动态供应。持久卷子系统为用户和管理员提供一组API（PersistentVolume 、PersistentVolumeClaim），将存储如何供应的细节从其如何被使用中抽象出来。

- 持久卷申领（PersistentVolumeClaim，PVC），用户对存储的请求。PVC可请求特定的**大小**和**访问模式**的存储。用户消耗**抽象**的存储资源，存在使用场景如：针对不同的用户，需要具有不同属性（如，性能）的持久卷。
- 
- 访问模式
  - ReadWriteOnce：卷可以被一个节点以读写方式挂载，命令行接口（CLI）可使用缩写RWO；
  - ReadOnlyMany：卷可以被多个节点以只读方式挂载，命令行接口（CLI）可使用缩写ROX；
  - ReadWriteMany：卷可以被多个节点以读写方式挂载，命令行接口（CLI）可使用缩写RWX。

> 注：每个卷同一时刻只能以一种访问模式挂载，即使该卷能够支持多种访问模式。
